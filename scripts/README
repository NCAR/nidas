
Scripts for doing builds of NIDAS under Debian, supporting native
amd64 builds and cross-builds for armel (namely Eurotech viper and titan),
and armhf (RaspberryPi 2).

The builds can be done from a full Debian system (which can of course be virtual)
or from within a docker/podman container.

For information on creating and running docker/podman images see the
"Using Podman/Docker" wiki page at
https://wiki.ucar.edu/pages/viewpage.action?pageId=458588376

Several scripts are used for building Debian packages.

Builds are simpler from a container, so using a chroot is no longer recommended.

If you still want to use a chroot, see https://wiki.debian.org/HowToPackageForDebian.
sbuild is used to create the necessary chroots, one for
each architecture, and schroot or sbuild-shell to execute commands
in the chroots.

The docker directory contains scripts and Dockerfiles for creating
docker/podman images for cross-building.

Scripts:

# To build docker/podman images:

cd docker

# build an Ubuntu i386 image for the specified release. Currently we're building for
# the bionic release.
./build_vortex_docker.sh release

# build images of Debian jessie in order to do cross-builds for armel (viper,titan)
# and armhf (RPi2)
./build_arm_docker.sh

# To run a container from podman for building nidas packages, providing
# a shell prompt:
cd ..

run_podman.sh [-p] [ armel | armhf | armbe | xenial | bionic ]
    -p: pull image from docker.io

    # If you have started a bionic image for building i386 vortex packages,
    # once the container shell is running, do:

    cd /root/nidas/scripts
    ./build_dpkg.sh -I bionic i386

    # If you have started an armel image for cross-building viper/titan packages,
    # once the container shell is running, do:

    cd /root/nidas/scripts
    ./build_dpkg.sh -I jessie armel

build_dpkg.sh [-c] [-I codename] [-i repo] arch
    Build debian packages of NIDAS for the specified architecture
    -c: build package under a chroot.  Not necessary from within docker/podman containers
    -I codename: install packages to /net/ftp/pub/archive/software/debian/codename-<codename>
    -i repo: install debian packages to the given repository
    arch is armel, armhf, amd64 or i386 (vortex)
    codename is jessie (for armel), bionic (for vortex) or whatever distribution has been enabled
	/net/ftp/pub/archive/software/debian


Old scripts for chroots:

sbuild_setup.sh
    Create chroots for amd64, armel and armhf architectures,
    and add the necessary development packages for building NIDAS.
    Requires sudo access.

update_chroots.sh
    Update development packages in the chroots. Requires sudo access.
    Over time, the development packages on the chroots become out-of-date.
    Use this script to update them.  If a package is undergoing
    frequent updates, which are important for building NIDAS, then
    then a manual update of the package using shell_chroot.sh
    may be the easiest method.

shell_chroot.sh
    Run a shell in the chroot under sudo, using sbuild-shell.
    Useful for trouble shooting, or manual package upgrades.

start_chroot.sh
    Run a shell in the chroot, using schroot. Similar to shell_chroot.sh,
    but does not use sudo.

build_nidas.sh arch
    Do a basic scons build of NIDAS for the given architecture. This script
    sets the PKG_CONFIG_PATH environment variable so that
    pkgconfig files specific to the architecture are found.


