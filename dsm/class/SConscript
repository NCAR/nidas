# -*- python -*-

##  Copyright 2005 UCAR, NCAR, All Rights Reserved

##
##  Import the cross-build environment.
##


Import('env')
myenv = env.Copy()

conf = Configure(myenv)

##
## Look for PostgreSQL header file. If found, build PSQL source files
##
if conf.CheckCHeader('libpq-fe.h'):
    PSQLSources = Split("""
	PSQLChannel.cc
	PSQLSampleOutput.cc
	PSQLProcessor.cc
    """)
else:
    PSQLSources = []

myenv = conf.Finish()

## version = myenv.Command('Version.h','Version',
## 	'sed -e "s/SOFTWARE_VERSION/`svnversion .`/" < $SOURCE > $TARGET')
## myenv.AlwaysBuild(version)
## Depends('Version.h','Version')

# -ggdb
# -DXML_DEBUG
myenv.AppendUnique(CXXFLAGS = Split("""
"""))

##
##  List the source files compiled into the libDsm.a library.
##

sources = [ Split("""

  Project.cc
  Aircraft.cc
  DSMConfig.cc
  SensorCatalog.cc

  DSMEngine.cc
  DSMServer.cc
  StatusThread.cc

  DSMSensor.cc
  RTL_DevIoctl.cc
  RTL_DevIoctlStore.cc
  RTL_DSMSensor.cc

  DSMArincSensor.cc
    ADC_HW_EB7022597.cc
    GPS_HW_HG2021GB02.cc
    Arinc_IRS.cc
      IRS_HW_HG2001GD.cc
      IRS_HW_YG1854.cc
  
  DSMSerialSensor.cc
  AsciiScanner.cc
  IRIGSensor.cc
  DSMAnalogSensor.cc

  Sample.cc
  Variable.cc
  VariableConverter.cc
  SampleTag.cc
  Parameter.cc

  SampleClientList.cc
  SampleSourceImpl.cc

  PortSelector.cc
  PortSelectorTest.cc
  RemoteSerialConnection.cc
  RemoteSerialListener.cc

  DOMObjectFactory.cc
  DynamicLoader.cc
  DOMable.cc

  XMLParser.cc
  XMLConfigWriter.cc
  XMLFdFormatTarget.cc

  DSMService.cc
  XMLConfigService.cc
  RawSampleService.cc

  SampleSorter.cc
  SyncRecordGenerator.cc

  IOChannel.cc
  IOStream.cc
  Socket.cc
  McSocket.cc
  FileSet.cc

  SampleInput.cc
  SampleOutput.cc
  SampleFileHeader.cc
  RawSampleOutputStream.cc
  RawSampleInputStream.cc
  SampleDater.cc

  SampleIOProcessor.cc
  SyncRecordProcessor.cc
  SampleArchiver.cc
  SampleAverager.cc

"""),PSQLSources]

## myenv['LEXCOM'] = '$LEX $LEXFLAGS -t $SOURCES > $TARGET'

## myenv['LEXFLAGS'] = Split("""
##     -Pscanf_fmt_yy -+
## """)

myenv.CXXFile(target='AsciiScanner.cc',source='AsciiScanner.ll')

##
##  Build the libArmDsm.a library.
##
## myenv.StaticLibrary('Dsm' , sources)
myenv.SharedLibrary('Dsm' , sources)
