# -*- python -*-

##  Copyright 2005 UCAR, NCAR, All Rights Reserved

##
##  Import the cross-build environment.
##
Import('env')
myenv = env.Copy()

##
## Look for PostgreSQL library.
## It looks like this check needs to be at the top of this file,
## just after the env.Copy(), otherwise it hangs forever.
##
conf = Configure(myenv)
conf.CheckLibWithHeader('pq','libpq-fe.h','c','PQconnectdb("");')
myenv = conf.Finish()

# -D__cpluscplus   -fno-common  -fno-builtin
# Import('arm_env')
# src_arm_env = arm_env.Copy()

## myenv.AppendUnique(CPPPATH = Split("""
##       #dsm/class
##       #dsm/modules
##     """))

myenv.AppendUnique(LIBS = Split("""
      Dsm
      isa
      xerces-c
      pthread
      dl
      XmlRpc
    """))

apps = Split("""
  dsm_server.cc
  dsm.cc
  serial_test.cc
  sensor_test.cc
  ck_selector.cc
  ck_serial.cc
  ck_config.cc
  sample_test.cc
  data_stats.cc
  data_dump.cc
  sync_dump.cc
  sync_server.cc
  status_listener.cc
  rserial.cc
  psi9116_sim.cc
  cat_nids.cc
""")

nodes = []
for i in apps:
  nodes += myenv.Program( i )

myenv.Install('$PREFIX/bin',nodes)
