# -*- python -*-

##
##  Import the cross-build environment.
##
Import('arm_env')
rtl_env = arm_env.Copy()

##
##  Adjust for kernel development (Not userspace)
##
rtl_env.AppendUnique(CCFLAGS=Split("""
  -fno-common -DMODULE -D__KERNEL__
  -D__LINUX_ARM_ARCH__=5
"""))

##
##  RTLinux specific settings
##
rtl_env.AppendUnique(CCFLAGS=Split("""
  -D_LOOSE_KERNEL_NAMES -D__RTL__
"""))
rtl_env.AppendUnique(CPPPATH=Split("""
  /opt/rtldk-2.0/rtlinux_kernel_2_4/include
  /opt/rtldk-2.0/rtlinuxpro/include
  /opt/rtldk-2.0/rtlinuxpro/include/linux-sys
  /opt/rtldk-2.0/rtlinuxpro/include/compat
  /opt/rtldk-2.0/rtlinuxpro/libc/include
  /opt/rtldk-2.0/rtlinuxpro/include/posix
"""))
##
##  Linux specific settings
##
#  -msoft-float -nostdinc -iwithprefix include
# rtl_env.AppendUnique(CCFLAGS=Split("""
# """))
# rtl_env.AppendUnique(CPPPATH=Split("""
#   /opt/rtldk-2.0/arm-linux/include
# """))
##
##  List of each module source
##
modules = Split("""
  isa_serial.c
  isa_demux.c
  irig_module.c
""")

##
##  Build the modules
##
for i in modules:
  rtl_env.Object( i )
